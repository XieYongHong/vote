<!doctype html>
<html class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>文章管理</title>

    <!-- Set render engine for 360 browser -->
    <meta name="renderer" content="webkit">

    <!-- No Baidu Siteapp-->
    <meta http-equiv="Cache-Control" content="no-siteapp" />


    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />

    <meta name="msapplication-TileColor" content="#0e90d2">

    <link rel="stylesheet" href="assets/css/amazeui.min.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="stylesheet" href="assets/css/content.css">
    <link rel="stylesheet" href="assets/css/umeditor.min.css">
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/amazeui.min.js"></script>
    
    <script type="text/plain" src="assets/js/umeditor.config.js"></script>
    <script type="text/plain" src="assets/js/umeditor.min.js"></script>
    <script src="assets/js/content.js"></script>
    <style>
        td{
            text-align: left;
        }
       .right{
           float: right;
       }
       .marright-30{
           margin-right: 30px;
       }
    </style>
</head>

<body>
    <div id="box" class="am-cf">
        <button type="button" class="am-btn am-btn-danger am-radius right marright-30" onclick="config.add()">添加</button>
        <table class="am-table am-table-striped am-table-hover">
            <thead>
                <tr>
                    <th>文章名</th>
                    <th>作者</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
    <div class="am-modal am-modal-no-btn" tabindex="-1" id="edit">
        <div class="am-modal-dialog imgp_box">
            <div class="am-modal-bd">
                <form action="" class="am-form">
                    <fieldset>
                        <div class="am-form-group">
                            <label for="id">ID号：</label>
                            <input type="text" id="id" minlength="3" placeholder="输入id" class="am-form-field" required/>
                        </div>
                        <div class="am-form-group">
                            <label for="name">文章名：</label>
                            <input type="text" id="name" minlength="3" placeholder="输入文章名" class="am-form-field" required/>
                        </div>
                        <div class="am-form-group">
                            <label for="author">作者：</label>
                            <input type="text" id="author" minlength="3" placeholder="输入作者" class="am-form-field" required/>
                        </div>
                    </fieldset>
                    <button type="button" class="am-btn am-btn-secondary am-radius" onclick="config.save(1,'edit')">保存</button>
                    <button type="button" class="am-btn am-btn-default am-radius" onclick="config.closeWin('edit')">取消</button>
                </form>
            </div>
        </div>
    </div>
    <div class="am-modal am-modal-no-btn" tabindex="-1" id="add">
        <div class="am-modal-dialog imgp_box">
            <div class="am-modal-bd">
                    <form action="" class="am-form">
                            <fieldset>
                                <div class="am-form-group">
                                    <label for="content">ID号：</label>
                                    <input type="text" id="id" minlength="3" placeholder="输入id" class="am-form-field" required/>  
                                </div>
                                <div class="am-form-group">
                                    <label for="name">文章名：</label>
                                    <input type="text" id="name" minlength="3" placeholder="输入文章名" class="am-form-field" required/>
                                </div>
                                <div class="am-form-group">
                                    <label for="author">作者：</label>
                                    <input type="text" id="author" minlength="3" placeholder="输入作者" class="am-form-field" required/>
                                </div>
                            </fieldset>
                            <button type="button" class="am-btn am-btn-secondary am-radius" onclick="config.save(2,'add')">保存</button>
                            <button type="button" class="am-btn am-btn-default am-radius" onclick="config.closeWin('add')">取消</button>
                    </form>
            </div>
        </div>
    </div>
    
    <script>
        $(function(){

            config.init();

        })
        
        var config = {
            init : function(){
                this.initAjax();
            },
            initAjax:function(){
                $.ajax({
                    url:'/getTicketNumbersAll',
                    type:'get',
                    data:{},
                    success:function(data){
                        if(data.success){
                            var str = ''
                            var tData = data.data
                            for(var i=0;i<tData.length;i++){
                                str += '<tr><td><div>'+tData[i].name+'</div></td><td><div>'+tData[i].author+'</div></td><td><div><button type="button" onclick="config.edit(\''+tData[i].id+'\')" class="am-btn am-btn-secondary am-radius am-btn-sm">编辑</button></div></td></tr>'
                            }
                            $('tbody').html(str);
                        }
                    }
                })
            },
            edit:function(id){
                var _this = this;
                $('#edit').modal('open');
                $('#edit').on('opened.modal.amui', function(){
                    $.ajax({
                        url:'/getTicketNumbers',
                        type:'post',
                        data:{
                            id:id
                        },
                        success:function(data){
                            if(data.success){
                                $('#edit #id').val(data.data.id)
                                $('#edit #name').val(data.data.name)
                                $('#edit #author').val(data.data.author)
                            }
                        }
                    })
                });
            },
            add:function(){
                $('#add').modal('open');
                $('#add').on('opened.modal.amui', function(){
                    console.log('添加文章');
                });
            },
            save:function(type,mod){
                var _this = this;
                var url = type == 1 ? '/editArticle':'/addArticle'
                var id = $('#'+mod+' #id').val(),
                    name = $('#'+mod+' #name').val(), 
                    author = $('#'+mod+' #author').val()
                if(!id && !name && !author){
                    return alert('id 或者 文章名 或者 作者不能为空')
                }
                $.ajax({
                    url:url,
                    type:'post',
                    data:{
                        id:id,
                        name:name,
                        author:author
                    },
                    success:function(data){
                        if(data.success){
                            _this.closeWin(mod);
                            _this.initAjax()
                        }
                    }
                })
                
            },
            closeWin:function(name){
                $('#'+name).modal('close');
            }
        }
    </script>
</body>

</html>